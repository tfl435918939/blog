---
layout:     post
title:      "一次完整的网络请求全过程"
subtitle:   " \"人生就像一场马拉松，跑到最后才是赢家。\""
date:       2018-04-27 15:02:00
author:     "Leon"
header-img: "img/2018-04-03-posts-bg.jpg"
catalog: true
tags:
    - 杂谈
---

> “Anyway, anyhow. ”


## 应用层
应用层在这里讲的是浏览器。在地址栏输入一串地址：``www.xx.xx``。

##### 域名地址

域名地址以主机(host)、子域 (sub domain)和域(domain)的形式表示的Internet地址(address)，与数字表示的IP地址(IP address)相对。分为顶级域名、二级域名和三级域名。N级域名就是在N-1级域名前追加一级。

比如二级域名是在一级域名前加一级，二级域名示例：``http://baidu.com``,`` http://zhihu.com ``,``http://qq.com``。``http://xxx.com.cn``是三级域名。

在网上辨别一台计算机的方式是利用IP地址。一组IP地址数字很不容易记忆，因此为网上的服务器取一个有意义又容易记忆的名字，这个名字的地址就是域名地址（Domain Name Server）。由于真正区分机器的还是IP地址，所以当用户输入域名后，浏览器必须要先去一台有域名和IP地址相互对应的数据库的主机中去查询这台计算机的IP地址，这台被查询的主机叫域名服务器（Domain Name Server，DNS）。

##### 寻址过程
一外国用户要寻找一台叫做host.edu.cn的中国主机。词用户“呼叫”host.edu.cn，本地域名服务器受理并分析号码；由于本地域名服务器中没有中国域名资料，必须向上一级查询，本地域名服务器向本地最高域名服务器问询；本地最高域名服务器检索自己的数据库，查到cn为中国，则指向中国的最高域名服务器；中国最高域名服务器分析号码，检测到第二级域名为edu，就指向edu域名服务器；经edu域名服务器分析找到本域内host主机所对应的IP地址，就指向名为HOST的主机，一个完整的寻址过程结束。

##### 相关协议
发送方：(七层模型由上至下)
HTTP(应用层)：HTTP协议的主要职责是生成针对目标web服务器的http请求报文。
TCP(传输层)：将http请求报文分割成报文段，按序号分为多个报文段。
IP(网络层)：搜索目标主机地址，一边中转一边传送。(路由)
ARP(网络层)：因为最终数据都要在数据链路层上进行传输，而数据链路层又不认识IP地址，所以ARP的职责就是把IP地址转换成数据链路层认识的MAC地址。

接受方：(七层模型由下至上)
RARP(网络层)：MAC地址->IP地址。
TCP(传输层)：将接收到的报文段按序号进行重组。
HTTP(应用层)：HTTP协议对http请求进行解析处理。

##### 一次完整请求过程
- （1）域名解析
- （2）建立TCP连接，三次握手
- （3）Web浏览器向Web服务端发送HTTP请求报文
- （4）服务器响应HTTP请求
- （5）浏览器解析HTML代码，并请求HTML代码中的资源（JS，CSS，图片）（这是自动向服务器请求下载的）
- （6）浏览器对页面进行渲染呈现给客户
- （7）断开TCP连接，四次挥手

关于TCP连接的建立和断开，请戳链接